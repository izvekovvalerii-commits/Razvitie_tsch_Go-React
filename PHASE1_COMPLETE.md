# ‚úÖ –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è RBAC - –ó–ê–í–ï–†–®–ï–ù–û

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤ (Performance Boost)

**–§–∞–π–ª:** `backend-go/cache/permissions_cache.go` (–Ω–æ–≤—ã–π)

**–ß—Ç–æ —ç—Ç–æ –¥–∞–µ—Ç:**
- **–°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ë–î:** —Å ~2 –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –∫–∞–∂–¥—ã–π HTTP request –¥–æ 0-1 –∑–∞–ø—Ä–æ—Å–æ–≤
- **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏:** –ø—Ä–∞–≤–∞ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ –ø–∞–º—è—Ç–∏ (–º–∫—Å –≤–º–µ—Å—Ç–æ –º—Å)
- **TTL 5 –º–∏–Ω—É—Ç:** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, –ø—Ä–∞–≤–∞ –Ω–µ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —Å–ª–∏—à–∫–æ–º "—Å—Ç–∞—Ä—ã–º–∏"
- **–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞:** —Ñ–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ —É–¥–∞–ª—è–µ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–ø–∏—Å–∏ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```
Request 1 (user: –ë–ê)  -> Cache MISS -> Load from DB -> Save to cache -> Return
Request 2 (user: –ë–ê)  -> Cache HIT  -> Return from cache ‚ö°
Request 3 (user: –ë–ê)  -> Cache HIT  -> Return from cache ‚ö°
...
```

**–ú–µ—Ç—Ä–∏–∫–∏ (–æ–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ):**
- –ü—Ä–∏ 100 req/sec: —ç–∫–æ–Ω–æ–º–∏—è ~100 DB queries/sec
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: -2-5ms per request

---

### 2. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫—ç—à–∞ –≤ AuthMiddleware

**–§–∞–π–ª:** `backend-go/middleware/auth.go`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```go
// –ë—ã–ª–æ: –≤—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –ë–î
var role models.Role
DB.Preload("Permissions").Where(&models.Role{Code: user.Role}).First(&role)

// –°—Ç–∞–ª–æ: —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞
perms, found := permCache.Get(user.Role)
if !found {
    // –¢–æ–ª—å–∫–æ –ø—Ä–∏ cache miss –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ –ë–î
    DB.Preload("Permissions")...
    permCache.Set(user.Role, perms)
}
```

**–ß—Ç–æ —ç—Ç–æ –¥–∞–µ—Ç:**
- –ü—Ä–æ–∑—Ä–∞—á–Ω–æ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞
- –ù–µ—Ç breaking changes
- –ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∞–≤ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

---

### 3. ‚úÖ –ê–≤—Ç–æ–∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø—Ä–∞–≤

**–§–∞–π–ª:** `backend-go/controllers/rbac_controller.go`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```go
func UpdateRolePermissions(...) {
    // ... –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –≤ –ë–î ...
    
    // –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º –∫—ç—à –¥–ª—è —ç—Ç–æ–π —Ä–æ–ª–∏
    cache.GetCache().Invalidate(role.Code)
    
    // –¢–µ–ø–µ—Ä—å –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—Ä–æ—Å–µ –ø—Ä–∞–≤–∞ –∑–∞–≥—Ä—É–∑—è—Ç—Å—è —Å–≤–µ–∂–∏–µ –∏–∑ –ë–î
}
```

**–ß—Ç–æ —ç—Ç–æ –¥–∞–µ—Ç:**
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø—Ä–∞–≤ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É –∫—ç—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç—Å—è
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∞—é—Ç –Ω–æ–≤—ã–µ –ø—Ä–∞–≤–∞ (–≤ —Ç–µ—á–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞)
- –†–∞–±–æ—Ç–∞–µ—Ç —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Å `refreshCurrentUser()` –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

---

### 4. ‚úÖ Seeder –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø—Ä–∞–≤–∞

**–§–∞–π–ª:** `backend-go/database/seeder.go`

**–ë—ã–ª–æ (–ü–†–û–ë–õ–ï–ú–ê):**
```go
// –ü—Ä–∏ –∫–∞–∂–¥–æ–º —Ä–µ—Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞:
DB.Model(&role).Association("Permissions").Replace(perms)
// ‚ò†Ô∏è –í—Å–µ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø—Ä–∞–≤–∞ —É–¥–∞–ª—è–ª–∏—Å—å!
```

**–°—Ç–∞–ª–æ (–†–ï–®–ï–ù–ò–ï):**
```go
// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–∞–≤–∞
var existingPerms []models.Permission
DB.Model(&role).Association("Permissions").Find(&existingPerms)

if len(existingPerms) == 0 {
    // –¢–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö —Ä–æ–ª–µ–π
    log.Printf("Initializing permissions for new role '%s'", roleCode)
    DB.Model(&role).Association("Permissions").Replace(perms)
} else {
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞—Å—Ç–æ–º–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
    log.Printf("Skipping role '%s' - already has %d permissions (preserving custom config)")
}
```

**–ß—Ç–æ —ç—Ç–æ –¥–∞–µ—Ç:**
- ‚úÖ –ü—Ä–∞–≤–∞, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É, —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ
- ‚úÖ –ù–æ–≤—ã–µ —Ä–æ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –ø—Ä–∞–≤–∞
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚ö†Ô∏è –ß—Ç–æ–±—ã —Å–±—Ä–æ—Å–∏—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ - –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –∏–∑ role_permissions

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –¢–µ—Å—Ç 1: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë–ê:
# - –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å: –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –ë–î + "Saved to cache: –ë–ê"
# - –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã: "Loaded from cache: –ë–ê"
```

### –¢–µ—Å—Ç 2: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø—Ä–∞–≤
1. –ó–∞–π–¥–∏—Ç–µ –ø–æ–¥ –∞–¥–º–∏–Ω–æ–º –≤ –∞–¥–º–∏–Ω–∫—É —Ä–æ–ª–µ–π
2. –î–æ–±–∞–≤—å—Ç–µ –ë–ê –ø—Ä–∞–≤–æ `project:delete`
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ
4. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä**
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ë–ê –≤—Å—ë –µ—â—ë –∏–º–µ–µ—Ç `project:delete` ‚úÖ

### –¢–µ—Å—Ç 3: –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞
1. –û—Ç–∫—Ä–æ–π—Ç–µ 2 –≤–∫–ª–∞–¥–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –ø–æ–¥ –ë–ê
2. –í –æ–¥–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –ø—Ä–æ–µ–∫—Ç (–ø—Ä–∞–≤–∞ –∑–∞–≥—Ä—É–∑—è—Ç—Å—è –≤ –∫—ç—à)
3. –í –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–µ (–ø–æ–¥ –∞–¥–º–∏–Ω–æ–º) –∏–∑–º–µ–Ω–∏—Ç–µ –ø—Ä–∞–≤–∞ –ë–ê
4. –û–±–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–≤—É—é –≤–∫–ª–∞–¥–∫—É
5. –ü—Ä–∞–≤–∞ –¥–æ–ª–∂–Ω—ã –æ–±–Ω–æ–≤–∏—Ç—å—Å—è (–∫—ç—à –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω) ‚úÖ

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
–î–æ–±–∞–≤—å—Ç–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫—ç—à–∞:

```go
// –í health endpoint:
router.GET("/health", func(c *gin.Context) {
    stats := cache.GetCache().GetStats()
    c.JSON(200, gin.H{
        "status": "ok",
        "cache_stats": stats,
    })
})
```

### –§–∞–∑–∞ 2 (—Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø)
–ò–∑ –∞–Ω–∞–ª–∏–∑–∞:
1. –ê—É–¥–∏—Ç RBAC –∏–∑–º–µ–Ω–µ–Ω–∏–π
2. –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø—Ä–∞–≤ –≤ UI
3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è frontend setCurrentUser

---

## –ò—Ç–æ–≥–æ

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** üìà
- DB load: -50% (–ø—Ä–∏–º–µ—Ä–Ω–æ)
- Response time: -2-5ms per request
- Cache hit ratio: ~95% (–æ–∂–∏–¥–∞–µ—Ç—Å—è)

**–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** üõ°Ô∏è
- –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø—Ä–∞–≤–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ
- –ê–≤—Ç–æ–∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- Thread-safe –∫—ç—à

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** ‚úÖ
- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∞–≤ –∏ —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–∂–∏–¥–∞–µ—Ç—Å—è.
