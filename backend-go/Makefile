.PHONY: help run build test clean install dev prod docker

help: ## –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É
	@echo "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-15s\033[0m %s\n", $$1, $$2}'

install: ## –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
	go mod download
	go mod tidy

run: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
	@echo "üöÄ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞..."
	@go run main.go

dev: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å hot-reload (—Ç—Ä–µ–±—É–µ—Ç air)
	@echo "üî• –ó–∞–ø—É—Å–∫ —Å hot-reload..."
	@air

build: ## –°–æ–±—Ä–∞—Ç—å –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª
	@echo "üî® –°–±–æ—Ä–∫–∞..."
	@go build -o portal-razvitie main.go
	@echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –ó–∞–ø—É—Å—Ç–∏—Ç–µ ./portal-razvitie"

build-linux: ## –°–æ–±—Ä–∞—Ç—å –¥–ª—è Linux
	@echo "üêß –°–±–æ—Ä–∫–∞ –¥–ª—è Linux..."
	@GOOS=linux GOARCH=amd64 go build -o portal-razvitie-linux main.go
	@echo "‚úÖ –ì–æ—Ç–æ–≤–æ!"

build-windows: ## –°–æ–±—Ä–∞—Ç—å –¥–ª—è Windows
	@echo "ü™ü –°–±–æ—Ä–∫–∞ –¥–ª—è Windows..."
	@GOOS=windows GOARCH=amd64 go build -o portal-razvitie.exe main.go
	@echo "‚úÖ –ì–æ—Ç–æ–≤–æ!"

test: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
	@echo "üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤..."
	@go test -v ./...

test-coverage: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
	@echo "üìä –¢–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º..."
	@go test -v -coverprofile=coverage.out ./...
	@go tool cover -html=coverage.out

clean: ## –û—á–∏—Å—Ç–∏—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
	@echo "üßπ –û—á–∏—Å—Ç–∫–∞..."
	@rm -f portal-razvitie portal-razvitie-linux portal-razvitie.exe
	@rm -f coverage.out
	@rm -rf uploads/*
	@echo "‚úÖ –û—á–∏—â–µ–Ω–æ!"

format: ## –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
	@echo "‚ú® –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞..."
	@go fmt ./...
	@echo "‚úÖ –ì–æ—Ç–æ–≤–æ!"

lint: ## –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ –ª–∏–Ω—Ç–µ—Ä–æ–º
	@echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–Ω—Ç–µ—Ä–æ–º..."
	@golint ./...

vet: ## –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ vet
	@echo "üî¨ –ü—Ä–æ–≤–µ—Ä–∫–∞ vet..."
	@go vet ./...

check: format vet ## –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞

docker-build: ## –°–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑
	@echo "üê≥ –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞..."
	@docker build -t portal-razvitie:latest .
	@echo "‚úÖ –ì–æ—Ç–æ–≤–æ!"

docker-run: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ Docker
	@echo "üê≥ –ó–∞–ø—É—Å–∫ –≤ Docker..."
	@docker run -p 5000:5000 --env-file .env portal-razvitie:latest

prod: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ production —Ä–µ–∂–∏–º–µ
	@echo "üöÄ –ó–∞–ø—É—Å–∫ –≤ production..."
	@GIN_MODE=release ./portal-razvitie

migrate: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
	@echo "üîÑ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î..."
	@go run main.go migrate

health: ## –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health endpoint
	@curl -s http://localhost:5000/health | python3 -m json.tool || curl -s http://localhost:5000/health

api-test: ## –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ API endpoints
	@echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API..."
	@echo "Health:"
	@curl -s http://localhost:5000/health
	@echo "\n\nStores:"
	@curl -s http://localhost:5000/api/stores | head -c 200
	@echo "\n\nProjects:"
	@curl -s http://localhost:5000/api/projects | head -c 200
	@echo "\n\nTasks:"
	@curl -s http://localhost:5000/api/tasks | head -c 200
	@echo "\n‚úÖ –ì–æ—Ç–æ–≤–æ!"

.DEFAULT_GOAL := help
