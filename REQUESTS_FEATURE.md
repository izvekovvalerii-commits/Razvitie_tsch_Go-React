# Система Заявок - Руководство

## Обзор

В систему добавлена новая сущность **"Заявка"**, которая позволяет сотрудникам запрашивать информацию друг у друга в рамках бизнес-процесса.

## Функциональность

### Основные возможности

1. **Создание заявки**
   - Пользователь может создать заявку с запросом информации
   - Указывается название, описание, приоритет и ответственный
   - Заявка автоматически отправляется ответственному

2. **Статусы заявки**
   - `Новая` - заявка создана, но не взята в работу
   - `В работе` - ответственный взял заявку в работу
   - `Отвечена` - ответственный предоставил ответ
   - `Закрыта` - инициатор закрыл заявку
   - `Отклонена` - ответственный отклонил заявку

3. **Приоритеты**
   - Низкий
   - Средний
   - Высокий
   - Срочный

4. **Действия с заявками**
   - **Инициатор** может:
     - Создавать заявки
     - Закрывать отвеченные заявки
     - Удалять новые заявки
   - **Ответственный** может:
     - Взять заявку в работу
     - Ответить на заявку
     - Отклонить заявку с указанием причины

5. **Фильтрация**
   - Все заявки
   - Мои заявки (созданные пользователем)
   - В работу мне (назначенные пользователю)
   - По статусу

6. **Уведомления**
   - При создании заявки ответственный получает уведомление
   - При изменении статуса участники получают уведомления
   - Уведомления интегрированы с WebSocket для real-time обновлений

## Backend API

### Эндпоинты

```
GET    /api/requests                    - Получить все заявки (с фильтрами)
GET    /api/requests/:id                - Получить заявку по ID
POST   /api/requests                    - Создать новую заявку
PUT    /api/requests/:id                - Обновить заявку
DELETE /api/requests/:id                - Удалить заявку
PUT    /api/requests/:id/take           - Взять в работу
PUT    /api/requests/:id/answer         - Ответить на заявку
PUT    /api/requests/:id/close          - Закрыть заявку
PUT    /api/requests/:id/reject         - Отклонить заявку
GET    /api/requests/stats/:userId      - Статистика по заявкам пользователя
```

### Пример создания заявки

```json
POST /api/requests
{
  "title": "Нужна информация по проекту X",
  "description": "Прошу предоставить актуальные данные по бюджету проекта X",
  "priority": "Высокий",
  "createdByUserId": 1,
  "assignedToUserId": 2,
  "projectId": 5,
  "dueDate": "2026-01-20T12:00:00Z"
}
```

## Frontend

### Навигация

Страница заявок доступна по маршруту: `/requests`

### Использование

1. **Создание заявки**
   - Нажмите кнопку "+ Создать заявку"
   - Заполните форму
   - Нажмите "Создать"

2. **Просмотр заявок**
   - Используйте фильтры для отображения нужных заявок
   - Кликните на карточку заявки для просмотра деталей

3. **Работа с заявкой**
   - **Если вы ответственный**:
     - Нажмите "Взять в работу"
     - Нажмите "Ответить" и напишите ответ
     - Или нажмите "Отклонить" с указанием причины
   - **Если вы инициатор**:
     - Дождитесь ответа
     - Нажмите "Закрыть заявку" если информация получена

## Архитектура

### Backend (Go)

```
models/request.go           - Модель данных
repositories/request_repository.go  - Работа с БД
services/request_service.go         - Бизнес-логика
controllers/request_controller.go   - HTTP обработчики
events/definitions.go               - События для заявок
```

### Frontend (React + TypeScript)

```
types/index.ts              - TypeScript типы
services/requests.ts        - API клиент
pages/Requests.tsx          - Страница управления заявками
pages/Requests.css          - Стили
```

### База данных

Таблица `Requests` с полями:
- Метаданные: ID, Title, Description, Status, Priority
- Участники: CreatedByUserId, AssignedToUserId
- Связи: ProjectId, TaskId (опционально)
- Временные метки: CreatedAt, UpdatedAt, TakenAt, AnsweredAt, ClosedAt
- Прочее: Response, DueDate

## События

Система генерирует следующие события:
- `request.created` - создана новая заявка
- `request.taken` - заявка взята в работу
- `request.answered` - получен ответ на заявку
- `request.closed` - заявка закрыта инициатором
- `request.rejected` - заявка отклонена

События используются для:
- Создания уведомлений
- Логирования активности
- WebSocket обновлений в реальном времени

## Миграция

Таблица `Requests` автоматически создается при запуске приложения через GORM AutoMigrate.

## Расширение функциональности

Возможные улучшения:
1. Добавление комментариев к заявкам
2. Прикрепление файлов
3. История изменений
4. Автоматическая эскалация при просрочке
5. Теги и категории заявок
6. Массовые операции
7. Экспорт в Excel
8. Аналитика и отчеты

## Безопасность

- Все маршруты защищены middleware аутентификации
- Валидация на уровне модели и контроллера
- Проверка прав доступа на каждое действие
- SQL injection защита через GORM
- XSS защита на frontend

## Тестирование

Для тестирования функциональности:

1. Запустите backend:
   ```bash
   cd backend-go
   go run main.go
   ```

2. Запустите frontend:
   ```bash
   cd frontend-react
   npm run dev
   ```

3. Откройте браузер: `http://localhost:5174/requests`

4. Войдите под двумя разными пользователями для тестирования полного цикла заявки
